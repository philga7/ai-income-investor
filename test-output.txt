
> ai-income-investor@0.1.0 test:unit
> jest

PASS __tests__/lib/financial/api/yahoo/data-transformation.test.ts
PASS components/dashboard/portfolio-summary.test.tsx
PASS components/mode-toggle.test.tsx
PASS components/portfolios/add-security-dialog.test.tsx
PASS __tests__/lib/financial/api/errors.test.ts
PASS __tests__/lib/financial/api/yahoo/error-handling.test.ts
PASS components/portfolios/csv-upload.test.tsx
PASS __tests__/services/technicalAnalysisService.test.ts
PASS __tests__/services/portfolioRebalancingService.test.ts
PASS components/dashboard/market-overview.test.tsx
PASS __tests__/components/form-validation.test.tsx
PASS __tests__/services/portfolioAnalyticsService.test.ts
PASS __tests__/services/enhancedPortfolioAnalysisService.test.ts
PASS __tests__/services/portfolioDataService.test.ts
PASS __tests__/lib/financial/api/yahoo/client.test.ts
PASS app/portfolios/[id]/portfolio-detail.test.tsx
PASS __tests__/lib/utils.test.ts
PASS __tests__/lib/ai/anthropic-client.test.ts
PASS __tests__/services/lotService.test.ts
FAIL __tests__/components/add-security-dialog-integration.test.tsx (6.317 s)
  ‚óè AddSecurityDialog Integration Tests ‚Ä∫ should handle complete security addition flow with real service calls

    TestingLibraryElementError: Unable to find an element with the text: AAPL. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body[39m
      [33mstyle[39m=[32m""[39m
    [36m>[39m
      [36m<div>[39m
        [36m<button[39m
          [33maria-controls[39m=[32m"radix-:r0:"[39m
          [33maria-expanded[39m=[32m"false"[39m
          [33maria-haspopup[39m=[32m"dialog"[39m
          [33mclass[39m=[32m"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"[39m
          [33mdata-state[39m=[32m"closed"[39m
          [33mtype[39m=[32m"button"[39m
        [36m>[39m
          [0mAdd Security[0m
        [36m</button>[39m
      [36m</div>[39m
    [36m</body>[39m

      147 |     // For now, just verify the component rendered and basic interactions work
      148 |     expect(screen.getByText('Add Security')).toBeInTheDocument();
    > 149 |     expect(screen.getByText('AAPL')).toBeInTheDocument();
          |                   ^
      150 |   });
      151 |
      152 |   it('should handle form validation errors properly', async () => {

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByText (__tests__/components/add-security-dialog-integration.test.tsx:149:19)

  ‚óè AddSecurityDialog Integration Tests ‚Ä∫ should handle form validation errors properly

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "Please add at least one valid lot"

    Number of calls: 0

    Ignored nodes: comments, script, style
    [36m<html[39m
      [33mclass[39m=[32m"light"[39m
      [33mstyle[39m=[32m"color-scheme: light;"[39m
    [36m>[39m
      [36m<head />[39m
      [36m<body[39m
        [33mdata-scroll-locked[39m=[32m"1"[39m
        [33mstyle[39m=[32m"pointer-events: none;"[39m
      [36m>[39m
        [36m<span[39m
          [33maria-hidden[39m=[32m"true"[39m
          [33mdata-aria-hidden[39m=[32m"true"[39m
          [33mdata-radix-focus-guard[39m=[32m""[39m
          [33mstyle[39m=[32m"outline: none; opacity: 0; position: fixed; pointer-events: none;"[39m
          [33mtabindex[39m=[32m"0"[39m
        [36m/>[39m
        [36m<div>[39m
          [36m<button[39m
            [33maria-controls[39m=[32m"radix-:r3:"[39m
            [33maria-expanded[39m=[32m"true"[39m
            [33maria-haspopup[39m=[32m"dialog"[39m
            [33maria-hidden[39m=[32m"true"[39m
            [33mclass[39m=[32m"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"[39m
            [33mdata-aria-hidden[39m=[32m"true"[39m
            [33mdata-state[39m=[32m"open"[39m
            [33mtype[39m=[32m"button"[39m
          [36m>[39m
            [0mAdd Security[0m
          [36m</button>[39m
          [36m<div[39m
            [33maria-hidden[39m=[32m"true"[39m
            [33mclass[39m=[32m"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"[39m
            [33mdata-aria-hidden[39m=[32m"true"[39m
            [33mdata-state[39m=[32m"open"[39m
            [33mstyle[39m=[32m"pointer-events: auto;"[39m
          [36m/>[39m
          [36m<div[39m
            [33maria-describedby[39m=[32m"radix-:r5:"[39m
            [33maria-labelledby[39m=[32m"radix-:r4:"[39m
            [33mclass[39m=[32m"fixed left-[50%] top-[50%] z-50 w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg sm:max-w-4xl max-h-[90vh] flex flex-col"[39m
            [33mdata-state[39m=[32m"open"[39m
            [33mid[39m=[32m"radix-:r3:"[39m
            [33mrole[39m=[32m"dialog"[39m
            [33mstyle[39m=[32m"pointer-events: auto;"[39m
            [33mtabindex[39m=[32m"-1"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex flex-col space-y-1.5 text-center sm:text-left flex-shrink-0"[39m
            [36m>[39m
              [36m<h2[39m
                [33mclass[39m=[32m"text-lg font-semibold leading-none tracking-tight"[39m
                [33mid[39m=[32m"radix-:r4:"[39m
              [36m>[39m
                [0mAdd Security[0m
              [36m</h2>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-sm text-muted-foreground"[39m
                [33mid[39m=[32m"radix-:r5:"[39m
              [36m>[39m
                [0mSearch for a security and add purchase lots to your portfolio[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex-1 overflow-y-auto space-y-4 min-h-0"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex gap-2"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative flex-1"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"lucide lucide-search absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mheight[39m=[32m"24"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mwidth[39m=[32m"24"[39m
                    [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                  [36m>[39m
                    [36m<circle[39m
                      [33mcx[39m=[32m"11"[39m
                      [33mcy[39m=[32m"11"[39m
                      [33mr[39m=[32m"8"[39m
                    [36m/>[39m
                    [36m<path[39m
                      [33md[39m=[32m"m21 21-4.3-4.3"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                  [36m<input[39m
                    [33mclass[39m=[32m"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 pl-8"[39m
                    [33mplaceholder[39m=[32m"Search by symbol or company name..."[39m
                    [33mtype[39m=[32m"search"[39m
                    [33mvalue[39m=[32m""[39m
                  [36m/>[39m
                [36m</div>[39m
                [36m<button[39m
                  [33mclass[39m=[32m"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"[39m
                [36m>[39m
                  [0mSearch[0m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 flex-shrink-0 border-t pt-4"[39m
            [36m>[39m
              [36m<button[39m
                [33mclass[39m=[32m"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"[39m
              [36m>[39m
                [0mCancel[0m
              [36m</button>[39m
              [36m<button[39m
                [33mclass[39m=[32m"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"[39m
              [36m>[39m
                [0mAdd Security[0m
              [36m</button>[39m
            [36m</div>[39m
            [36m<button[39m
              [33mclass[39m=[32m"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground"[39m
              [33mtype[39m=[32m"button"[39m
            [36m>[39m
              [36m<svg[39m
                [33mclass[39m=[32m"lucide lucide-x h-4 w-4"[39m
                [33mfill[39m=[32m"none"[39m
                [33mheight[39m=[32m"24"[39m
                [33mstroke[39m=[32m"currentColor"[39m
                [33mstroke-linecap[39m=[32m"round"[39m
                [33mstroke-linejoin[39m=[32m"round"[39m
                [33mstroke-width[39m=[32m"2"[39m
                [33mviewBox[39m=[32m"0 0 24 24"[39m
                [33mwidth[39m=[32m"24"[39m
                [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
              [36m>[39m
                [36m<path[39m
                  [33md[39m=[32m"M18 6 6 18"[39m
                [36m/>[39m
                [36m<path[39m
                  [33md[39m=[32m"m6 6 12 12"[39m
                [36m/>[39m
              [36m</svg>[39m
              [36m<span[39m
                [33mclass[39m=[32m"sr-only"[39m
              [36m>[39m
                [0mClose[0m
              [36m</span>[39m
            [36m</button>[39m
          [36m</div>[39m
        [36m</div>[39m
        [36m<span[39m
          [33maria-hidden[39m=[32m"true"[39m
          [33mdata-aria-hidden[39m=[32m"true"[39m
          [33mdata-radix-focus-guard[39m=[32m""[39m
          [33mstyle[39m=[32m"outline: none; opacity: 0; position: fixed; pointer-events: none;"[39m
          [33mtabindex[39m=[32m"0"[39m
        [36m/>[39m
      [36m</body>[39m
    [36m</html>[39m

      168 |     // Should show validation error
      169 |     await waitFor(() => {
    > 170 |       expect(require('sonner').toast.error).toHaveBeenCalledWith('Please add at least one valid lot');
          |                                             ^
      171 |     });
      172 |   });
      173 |

      at toHaveBeenCalledWith (__tests__/components/add-security-dialog-integration.test.tsx:170:45)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:127:77)
      at checkRealTimersCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:121:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ‚óè AddSecurityDialog Integration Tests ‚Ä∫ should handle cash mode correctly

    Found multiple elements with the display value: 1.00.

    Here are the matching elements:

    Ignored nodes: comments, script, style
    [36m<input[39m
      [33mclass[39m=[32m"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"[39m
      [33mdisabled[39m=[32m""[39m
      [33mvalue[39m=[32m"1.00"[39m
    [36m/>[39m

    Ignored nodes: comments, script, style
    [36m<input[39m
      [33mclass[39m=[32m"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"[39m
      [33mid[39m=[32m"price-0"[39m
      [33mmin[39m=[32m"0.01"[39m
      [33mplaceholder[39m=[32m"e.g., 150.00"[39m
      [33mrequired[39m=[32m""[39m
      [33mstep[39m=[32m"0.01"[39m
      [33mtype[39m=[32m"number"[39m
      [33mvalue[39m=[32m"1.00"[39m
    [36m/>[39m

    (If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).

    Ignored nodes: comments, script, style
    [36m<body[39m
      [33mdata-scroll-locked[39m=[32m"1"[39m
      [33mstyle[39m=[32m"pointer-events: none;"[39m
    [36m>[39m
      [36m<span[39m
        [33maria-hidden[39m=[32m"true"[39m
        [33mdata-aria-hidden[39m=[32m"true"[39m
        [33mdata-radix-focus-guard[39m=[32m""[39m
        [33mstyle[39m=[32m"outline: none; opacity: 0; position: fixed; pointer-events: none;"[39m
        [33mtabindex[39m=[32m"0"[39m
      [36m/>[39m
      [36m<div>[39m
        [36m<button[39m
          [33maria-controls[39m=[32m"radix-:rc:"[39m
          [33maria-expanded[39m=[32m"true"[39m
          [33maria-haspopup[39m=[32m"dialog"[39m
          [33maria-hidden[39m=[32m"true"[39m
          [33mclass[39m=[32m"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"[39m
          [33mdata-aria-hidden[39m=[32m"true"[39m
          [33mdata-state[39m=[32m"open"[39m
          [33mtype[39m=[32m"button"[39m
        [36m>[39m
          [0mAdd Cash[0m
        [36m</button>[39m
        [36m<div[39m
          [33maria-hidden[39m=[32m"true"[39m
          [33mclass[39m=[32m"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"[39m
          [33mdata-aria-hidden[39m=[32m"true"[39m
          [33mdata-state[39m=[32m"open"[39m
          [33mstyle[39m=[32m"pointer-events: auto;"[39m
        [36m/>[39m
        [36m<div[39m
          [33maria-describedby[39m=[32m"radix-:re:"[39m
          [33maria-labelledby[39m=[32m"radix-:rd:"[39m
          [33mclass[39m=[32m"fixed left-[50%] top-[50%] z-50 w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg sm:max-w-4xl max-h-[90vh] flex flex-col"[39m
          [33mdata-state[39m=[32m"open"[39m
          [33mid[39m=[32m"radix-:rc:"[39m
          [33mrole[39m=[32m"dialog"[39m
          [33mstyle[39m=[32m"pointer-events: auto;"[39m
          [33mtabindex[39m=[32m"-1"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex flex-col space-y-1.5 text-center sm:text-left flex-shrink-0"[39m
          [36m>[39m
            [36m<h2[39m
              [33mclass[39m=[32m"text-lg font-semibold leading-none tracking-tight"[39m
              [33mid[39m=[32m"radix-:rd:"[39m
            [36m>[39m
              [0mAdd Cash[0m
            [36m</h2>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-sm text-muted-foreground"[39m
              [33mid[39m=[32m"radix-:re:"[39m
            [36m>[39m
              [0mEnter your cash balance for this portfolio.[0m
            [36m</p>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex-1 overflow-y-auto space-y-4 min-h-0"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"space-y-4"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"grid grid-cols-2 gap-4"[39m
              [36m>[39m
                [36m<div>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"block text-sm font-medium mb-1"[39m
                  [36m>[39m
                    [0mTicker[0m
                  [36m</label>[39m
                  [36m<input[39m
                    [33mclass[39m=[32m"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"[39m
                    [33mdisabled[39m=[32m""[39m
                    [33mvalue[39m=[32m"CASH"[39m
                  [36m/>[39m
                [36m</div>[39m
                [36m<div>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"block text-sm font-medium mb-1"[39m
                  [36m>[39m
                    [0mName[0m
                  [36m</label>[39m
                  [36m<input[39m
                    [33mclass[39m=[32m"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"[39m
                    [33mdisabled[39m=[32m""[39m
                    [33mvalue[39m=[32m"Cash"[39m
                  [36m/>[39m
                [36m</div>[39m
                [36m<div>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"block text-sm font-medium mb-1"[39m
                  [36m>[39m
                    [0mPrice[0m
                  [36m</label>[39m
                  [36m<input[39m
                    [33mclass[39m=[32m"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"[39m
                    [33mdisabled[39m=[32m""[39m
                    [33mvalue[39m=[32m"1.00"[39m
                  [36m/>[39m
                [36m</div>[39m
                [36m<div>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"block text-sm font-medium mb-1"[39m
                  [36m>[39m
                    [0mDividend[0m
                  [36m</label>[39m
                  [36m<input[39m
                    [33mclass[39m=[32m"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"[39m
                    [33mdisabled[39m=[32m""[39m
                    [33mvalue[39m=[32m"0"[39m
                  [36m/>[39m
                [36m</div>[39m
                [36m<div>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"block text-sm font-medium mb-1"[39m
                  [36m>[39m
    ...

      234 |
      235 |     // Should pre-fill with CASH security
    > 236 |     await waitFor(() => {
          |                  ^
      237 |       expect(screen.getByDisplayValue('CASH')).toBeInTheDocument();
      238 |       expect(screen.getByDisplayValue('1.00')).toBeInTheDocument();
      239 |     });

      at waitForWrapper (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:166:27)
      at Object.<anonymous> (__tests__/components/add-security-dialog-integration.test.tsx:236:18)

  ‚óè AddSecurityDialog Integration Tests ‚Ä∫ should handle existing tickers validation

    Unable to find an element with the text: AAPL. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body[39m
      [33mdata-scroll-locked[39m=[32m"1"[39m
      [33mstyle[39m=[32m"pointer-events: none;"[39m
    [36m>[39m
      [36m<span[39m
        [33maria-hidden[39m=[32m"true"[39m
        [33mdata-aria-hidden[39m=[32m"true"[39m
        [33mdata-radix-focus-guard[39m=[32m""[39m
        [33mstyle[39m=[32m"outline: none; opacity: 0; position: fixed; pointer-events: none;"[39m
        [33mtabindex[39m=[32m"0"[39m
      [36m/>[39m
      [36m<div>[39m
        [36m<button[39m
          [33maria-controls[39m=[32m"radix-:rf:"[39m
          [33maria-expanded[39m=[32m"true"[39m
          [33maria-haspopup[39m=[32m"dialog"[39m
          [33maria-hidden[39m=[32m"true"[39m
          [33mclass[39m=[32m"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"[39m
          [33mdata-aria-hidden[39m=[32m"true"[39m
          [33mdata-state[39m=[32m"open"[39m
          [33mtype[39m=[32m"button"[39m
        [36m>[39m
          [0mAdd Security[0m
        [36m</button>[39m
        [36m<div[39m
          [33maria-hidden[39m=[32m"true"[39m
          [33mclass[39m=[32m"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"[39m
          [33mdata-aria-hidden[39m=[32m"true"[39m
          [33mdata-state[39m=[32m"open"[39m
          [33mstyle[39m=[32m"pointer-events: auto;"[39m
        [36m/>[39m
        [36m<div[39m
          [33maria-describedby[39m=[32m"radix-:rh:"[39m
          [33maria-labelledby[39m=[32m"radix-:rg:"[39m
          [33mclass[39m=[32m"fixed left-[50%] top-[50%] z-50 w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg sm:max-w-4xl max-h-[90vh] flex flex-col"[39m
          [33mdata-state[39m=[32m"open"[39m
          [33mid[39m=[32m"radix-:rf:"[39m
          [33mrole[39m=[32m"dialog"[39m
          [33mstyle[39m=[32m"pointer-events: auto;"[39m
          [33mtabindex[39m=[32m"-1"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex flex-col space-y-1.5 text-center sm:text-left flex-shrink-0"[39m
          [36m>[39m
            [36m<h2[39m
              [33mclass[39m=[32m"text-lg font-semibold leading-none tracking-tight"[39m
              [33mid[39m=[32m"radix-:rg:"[39m
            [36m>[39m
              [0mAdd Security[0m
            [36m</h2>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-sm text-muted-foreground"[39m
              [33mid[39m=[32m"radix-:rh:"[39m
            [36m>[39m
              [0mSearch for a security and add purchase lots to your portfolio[0m
            [36m</p>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex-1 overflow-y-auto space-y-4 min-h-0"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex gap-2"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"relative flex-1"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"lucide lucide-search absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                  [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                [36m>[39m
                  [36m<circle[39m
                    [33mcx[39m=[32m"11"[39m
                    [33mcy[39m=[32m"11"[39m
                    [33mr[39m=[32m"8"[39m
                  [36m/>[39m
                  [36m<path[39m
                    [33md[39m=[32m"m21 21-4.3-4.3"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<input[39m
                  [33mclass[39m=[32m"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 pl-8"[39m
                  [33mplaceholder[39m=[32m"Search by symbol or company name..."[39m
                  [33mtype[39m=[32m"search"[39m
                  [33mvalue[39m=[32m"AAPL"[39m
                [36m/>[39m
              [36m</div>[39m
              [36m<button[39m
                [33mclass[39m=[32m"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"[39m
              [36m>[39m
                [0mSearch[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 flex-shrink-0 border-t pt-4"[39m
          [36m>[39m
            [36m<button[39m
              [33mclass[39m=[32m"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"[39m
            [36m>[39m
              [0mCancel[0m
            [36m</button>[39m
            [36m<button[39m
              [33mclass[39m=[32m"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"[39m
            [36m>[39m
              [0mAdd Security[0m
            [36m</button>[39m
          [36m</div>[39m
          [36m<button[39m
            [33mclass[39m=[32m"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground"[39m
            [33mtype[39m=[32m"button"[39m
          [36m>[39m
            [36m<svg[39m
              [33mclass[39m=[32m"lucide lucide-x h-4 w-4"[39m
              [33mfill[39m=[32m"none"[39m
              [33mheight[39m=[32m"24"[39m
              [33mstroke[39m=[32m"currentColor"[39m
              [33mstroke-linecap[39m=[32m"round"[39m
              [33mstroke-linejoin[39m=[32m"round"[39m
              [33mstroke-width[39m=[32m"2"[39m
              [33mviewBox[39m=[32m"0 0 24 24"[39m
              [33mwidth[39m=[32m"24"[39m
              [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
            [36m>[39m
              [36m<path[39m
                [33md[39m=[32m"M18 6 6 18"[39m
              [36m/>[39m
              [36m<path[39m
                [33md[39m=[32m"m6 6 12 12"[39m
              [36m/>[39m
            [36m</svg>[39m
            [36m<span[39m
              [33mclass[39m=[32m"sr-only"[39m
            [36m>[39m
              [0mClose[0m
            [36m</span>[39m
          [36m</button>[39m
        [36m</div>[39m
      [36m</div>[39m
      [36m<span[39m
        [33maria-hidden[39m=[32m"true"[39m
        [33mdata-aria-hidden[39m=[32m"true"[39m
        [33mdata-radix-focus-guard[39m=[32m""[39m
        [33mstyle[39m=[32m"outline: none; opacity: 0; position: fixed; pointer-events: none;"[39m
        [33mtabindex[39m=[32m"0"[39m
      [36m/>[39m
    [36m</body>[39m

      276 |     await user.click(screen.getByText('Search'));
      277 |
    > 278 |     await waitFor(() => {
          |                  ^
      279 |       expect(screen.getByText('AAPL')).toBeInTheDocument();
      280 |     });
      281 |

      at waitForWrapper (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:166:27)
      at Object.<anonymous> (__tests__/components/add-security-dialog-integration.test.tsx:278:18)

  ‚óè AddSecurityDialog Integration Tests ‚Ä∫ should handle basic search and selection flow

    Unable to find an element with the text: AAPL. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body[39m
      [33mdata-scroll-locked[39m=[32m"1"[39m
      [33mstyle[39m=[32m"pointer-events: none;"[39m
    [36m>[39m
      [36m<span[39m
        [33maria-hidden[39m=[32m"true"[39m
        [33mdata-aria-hidden[39m=[32m"true"[39m
        [33mdata-radix-focus-guard[39m=[32m""[39m
        [33mstyle[39m=[32m"outline: none; opacity: 0; position: fixed; pointer-events: none;"[39m
        [33mtabindex[39m=[32m"0"[39m
      [36m/>[39m
      [36m<div>[39m
        [36m<button[39m
          [33maria-controls[39m=[32m"radix-:ri:"[39m
          [33maria-expanded[39m=[32m"true"[39m
          [33maria-haspopup[39m=[32m"dialog"[39m
          [33maria-hidden[39m=[32m"true"[39m
          [33mclass[39m=[32m"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"[39m
          [33mdata-aria-hidden[39m=[32m"true"[39m
          [33mdata-state[39m=[32m"open"[39m
          [33mtype[39m=[32m"button"[39m
        [36m>[39m
          [0mAdd Security[0m
        [36m</button>[39m
        [36m<div[39m
          [33maria-hidden[39m=[32m"true"[39m
          [33mclass[39m=[32m"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"[39m
          [33mdata-aria-hidden[39m=[32m"true"[39m
          [33mdata-state[39m=[32m"open"[39m
          [33mstyle[39m=[32m"pointer-events: auto;"[39m
        [36m/>[39m
        [36m<div[39m
          [33maria-describedby[39m=[32m"radix-:rk:"[39m
          [33maria-labelledby[39m=[32m"radix-:rj:"[39m
          [33mclass[39m=[32m"fixed left-[50%] top-[50%] z-50 w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg sm:max-w-4xl max-h-[90vh] flex flex-col"[39m
          [33mdata-state[39m=[32m"open"[39m
          [33mid[39m=[32m"radix-:ri:"[39m
          [33mrole[39m=[32m"dialog"[39m
          [33mstyle[39m=[32m"pointer-events: auto;"[39m
          [33mtabindex[39m=[32m"-1"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex flex-col space-y-1.5 text-center sm:text-left flex-shrink-0"[39m
          [36m>[39m
            [36m<h2[39m
              [33mclass[39m=[32m"text-lg font-semibold leading-none tracking-tight"[39m
              [33mid[39m=[32m"radix-:rj:"[39m
            [36m>[39m
              [0mAdd Security[0m
            [36m</h2>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-sm text-muted-foreground"[39m
              [33mid[39m=[32m"radix-:rk:"[39m
            [36m>[39m
              [0mSearch for a security and add purchase lots to your portfolio[0m
            [36m</p>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex-1 overflow-y-auto space-y-4 min-h-0"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex gap-2"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"relative flex-1"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"lucide lucide-search absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                  [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                [36m>[39m
                  [36m<circle[39m
                    [33mcx[39m=[32m"11"[39m
                    [33mcy[39m=[32m"11"[39m
                    [33mr[39m=[32m"8"[39m
                  [36m/>[39m
                  [36m<path[39m
                    [33md[39m=[32m"m21 21-4.3-4.3"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<input[39m
                  [33mclass[39m=[32m"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 pl-8"[39m
                  [33mplaceholder[39m=[32m"Search by symbol or company name..."[39m
                  [33mtype[39m=[32m"search"[39m
                  [33mvalue[39m=[32m"AAPL"[39m
                [36m/>[39m
              [36m</div>[39m
              [36m<button[39m
                [33mclass[39m=[32m"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"[39m
              [36m>[39m
                [0mSearch[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 flex-shrink-0 border-t pt-4"[39m
          [36m>[39m
            [36m<button[39m
              [33mclass[39m=[32m"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"[39m
            [36m>[39m
              [0mCancel[0m
            [36m</button>[39m
            [36m<button[39m
              [33mclass[39m=[32m"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"[39m
            [36m>[39m
              [0mAdd Security[0m
            [36m</button>[39m
          [36m</div>[39m
          [36m<button[39m
            [33mclass[39m=[32m"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground"[39m
            [33mtype[39m=[32m"button"[39m
          [36m>[39m
            [36m<svg[39m
              [33mclass[39m=[32m"lucide lucide-x h-4 w-4"[39m
              [33mfill[39m=[32m"none"[39m
              [33mheight[39m=[32m"24"[39m
              [33mstroke[39m=[32m"currentColor"[39m
              [33mstroke-linecap[39m=[32m"round"[39m
              [33mstroke-linejoin[39m=[32m"round"[39m
              [33mstroke-width[39m=[32m"2"[39m
              [33mviewBox[39m=[32m"0 0 24 24"[39m
              [33mwidth[39m=[32m"24"[39m
              [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
            [36m>[39m
              [36m<path[39m
                [33md[39m=[32m"M18 6 6 18"[39m
              [36m/>[39m
              [36m<path[39m
                [33md[39m=[32m"m6 6 12 12"[39m
              [36m/>[39m
            [36m</svg>[39m
            [36m<span[39m
              [33mclass[39m=[32m"sr-only"[39m
            [36m>[39m
              [0mClose[0m
            [36m</span>[39m
          [36m</button>[39m
        [36m</div>[39m
      [36m</div>[39m
      [36m<span[39m
        [33maria-hidden[39m=[32m"true"[39m
        [33mdata-aria-hidden[39m=[32m"true"[39m
        [33mdata-radix-focus-guard[39m=[32m""[39m
        [33mstyle[39m=[32m"outline: none; opacity: 0; position: fixed; pointer-events: none;"[39m
        [33mtabindex[39m=[32m"0"[39m
      [36m/>[39m
    [36m</body>[39m

      321 |
      322 |     // Wait for search results and select security
    > 323 |     await waitFor(() => {
          |                  ^
      324 |       expect(screen.getByText('AAPL')).toBeInTheDocument();
      325 |     });
      326 |     await user.click(screen.getByText('Select'));

      at waitForWrapper (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:166:27)
      at Object.<anonymous> (__tests__/components/add-security-dialog-integration.test.tsx:323:18)

Test Suites: 1 failed, 19 passed, 20 total
Tests:       5 failed, 258 passed, 263 total
Snapshots:   0 total
Time:        6.88 s, estimated 7 s
Ran all test suites.
